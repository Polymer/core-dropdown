<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-overlay/core-overlay.html">

<!--

`core-popup-overlay` is a helper class to position an overlay relative to another
element.

@group Polymer Core Elements
@element core-popup-overlay
@extends core-overlay
@homepage github.io
-->

<polymer-element name="core-popup-overlay" extends="core-overlay">
<script>
    Polymer({

      publish: {

        /**
         * The `relatedTarget` is an element used to position the overlay, for example a
         * button the user taps to show a menu.
         *
         * @attribute relatedTarget
         * @type Element
         */
        relatedTarget: null,

        /**
         * The horizontal alignment of the overlay relative to the `relatedTarget`.
         *
         * @attribute halign
         * @type 'left'|'right'
         * @default 'auto'
         */
        halign: 'left',

        /**
         * The vertical alignment of the overlay relative to the `relatedTarget`.
         *
         * @attribute valign
         * @type 'top'|'bottom'
         * @default 'bottom'
         */
        valign: 'bottom',

        margin: 12

      },

      positionTarget: function() {
        if (!this.relatedTarget) {
          this.super();
          return;
        }

        var top, left, bottom, right;
        var ref = this.relatedTarget.getBoundingClientRect();

        // if (this._shouldPosition.left) {
          if (this.halign === 'left') {
            left = ref.left;
          } else if (this.halign === 'right') {
            left = Math.max(ref.right - this.target.offsetWidth, this.margin);
          }
          this.target.style.left = left + 'px';
        // }

        // if (this._shouldPosition.top) {
          if (this.valign === 'bottom') {
            top = ref.top;
          } else {
            top = Math.max(ref.bottom - this.target.offsetHeight, this.margin)
          }
          this.target.style.top = top + 'px';
        // }

      },

      sizeTarget: function() {
        var sizer = this.sizingTarget || this.target;
        var rect = sizer.getBoundingClientRect();
        var ref = this.relatedTarget.getBoundingClientRect();

        var minW = ref.width + 'px';

        // at least as wide as the relatedTarget
        sizer.style.minWidth = minW + 'px';

        var maxW, maxH;

        // if (this._shouldPosition.left) {
          if (this.halign === 'left') {
            maxW = window.innerWidth - rect.left - this.margin;
          } else {
            maxW = ref.right - rect.left;
          }
          sizer.style.maxWidth = maxW + 'px';
        // }

        // if (this._shouldPosition.top) {
          if (this.valign === 'bottom') {
            maxH = window.innerHeight - rect.top - this.margin;
          } else {
            maxH = ref.bottom - rect.top;
          }
          sizer.style.maxHeight = maxH + 'px';
        // }

        // if (!this._shouldPosition.left && !this._shouldPosition.top) {
        //   this.super();
        // }
      }

    });
  </script>
</polymer-element>
